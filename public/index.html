<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‚ù§Ô∏è Like Duel - Tosh-Qaychi-Qog'oz Duel va Do'stlar Tizimi</title>
    
    <!-- CDN kutubxonalari -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Mahalliy fayllar -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container">
        <!-- NAVIGATION TABS (PASTDA) -->
        <div class="nav-tabs-bottom">
            <div class="nav-tab active" data-tab="duel">
                <i class="fas fa-gamepad"></i>
                <span>Duel</span>
            </div>
            <div class="nav-tab" data-tab="profile">
                <i class="fas fa-user"></i>
                <span>Profil</span>
            </div>
            <div class="nav-tab" data-tab="friends">
                <i class="fas fa-users"></i>
                <span>Do'stlar</span>
            </div>
            <div class="nav-tab" data-tab="shop">
                <i class="fas fa-shopping-cart"></i>
                <span>Do'kon</span>
            </div>
            <div class="nav-tab" data-tab="leaderboard">
                <i class="fas fa-trophy"></i>
                <span>Liderlar</span>
            </div>
        </div>

        <!-- ASOSIY KONTENT -->
        <div class="main-content">
            <!-- HEADER -->
            <div class="app-header">
                <div class="header-title">
                    <i class="fas fa-fist-raised"></i>
                    <span>RPS Duel</span>
                </div>
                <div class="header-stats">
                    <div class="stat-item" id="coinsStat">
                        <i class="fas fa-coins"></i>
                        <span id="coinsCount">100</span>
                    </div>
                    <div class="stat-item" id="levelStat">
                        <i class="fas fa-star"></i>
                        <span id="levelCount">1</span>
                    </div>
                    <div class="stat-item" id="connectionStatus">
                        <i class="fas fa-wifi"></i>
                        <span id="connectionStatusBadge">Offline</span>
                    </div>
                </div>
            </div>

            <!-- DUEL TAB -->
            <div class="tab-content active" id="duelTab">
                <!-- WELCOME SCREEN -->
                <div class="duel-container" id="welcomeScreen">
                    <div class="profile-card" id="profileCard">
                        <img src="" alt="Siz" class="profile-avatar" id="myAvatar">
                        <div class="profile-name" id="myName">Foydalanuvchi</div>
                        <div class="profile-username" id="myUsername">@username</div>

                        <div class="stats" style="display: flex; justify-content: space-around; margin: 20px 0;">
                            <div class="stat">
                                <div class="stat-value" id="myMatches">0</div>
                                <div class="stat-label">O'yinlar</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value" id="myWins">0</div>
                                <div class="stat-label">G'alaba</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value" id="myDraws">0</div>
                                <div class="stat-label">Durang</div>
                            </div>
                        </div>

                        <!-- Gender Filter -->
                        <div id="genderFilterContainer"></div>

                        <!-- IKKITA ASOSIY TUGMA -->
                        <div class="action-buttons">
                            <button id="startBtn" class="start-btn">
                                üîó Serverga Ulanish
                            </button>
                            <button id="enterQueueBtn" class="start-btn" disabled>
                                üéÆ Navbatga Kirish
                            </button>
                        </div>

                        <!-- QO'SHIMCHA TUGMALAR -->
                        <div class="additional-actions">
                            <button class="secondary-btn" onclick="showGenderModal(true)">
                                <i class="fas fa-venus-mars"></i> 
                            </button>
                            <button class="secondary-btn" id="editProfileBtn">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="secondary-btn" onclick="showRPSStatistics()">
                                <i class="fas fa-chart-bar"></i>
                            </button>
                            <button class="secondary-btn" id="rulesBtn">
                                <i class="fas fa-question-circle"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- QUEUE SCREEN -->
                <div class="duel-container hidden" id="queueScreen">
                    <div class="loader"></div>
                    <div class="waiting-info" style="font-size: 1.2rem; margin-bottom: 15px; color: #fff;">Navbatda kutish...</div>
                    <div class="waiting-count" id="waitingCount">0</div>
                    <div class="position-info" id="positionInfo">
                        Sizning o'rningiz: <span id="position">-</span>
                    </div>
                    <div class="status-message" id="queueStatus" style="color: #ccc;">
                        Serverga ulanmoqda...
                    </div>

                    <div class="gender-warning hidden" id="genderWarning">
                        <div class="gender-warning-content">
                            <i class="fas fa-exclamation-triangle"></i>
                            <div>
                                <div style="font-weight: bold; font-size: 1.1rem; color: #e74c3c;">Gender tanlanmagan!</div>
                                <div style="color: #ccc;">Duel qilish uchun gender tanlashingiz kerak</div>
                            </div>
                        </div>
                        <button id="selectGenderNowBtn" class="gender-select-btn">
                            <i class="fas fa-user-edit"></i> Hozir tanlash
                        </button>
                    </div>

                    <button class="start-btn" id="leaveQueueBtn" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); margin-top: 20px;">
                        üö™ Navbatdan Chiqish
                    </button>
                </div>

                <!-- DUEL SCREEN (Tosh-Qaychi-Qog'oz) -->
                <div class="duel-container hidden" id="duelScreen">
                    <img src="" alt="Raqib" class="opponent-avatar" id="opponentAvatar">
                    <div class="opponent-info">
                        <div class="opponent-name" id="opponentName">Raqib</div>
                        <div class="opponent-username" id="opponentUsername">@username</div>

                        <div class="opponent-stats">
                            <span><i class="fas fa-trophy"></i> <span id="opponentRating">1500</span></span>
                            <span><i class="fas fa-gamepad"></i> <span id="opponentGames">0</span></span>
                            <span><i class="fas fa-level-up-alt"></i> <span id="opponentLevel">1</span></span>
                        </div>
                    </div>

                    <!-- TANLOVLAR KO'RSATISH -->
                    <div class="choices-display">
                        <div class="choice-box">
                            <div class="choice-label">Siz</div>
                            <div class="choice-icon" id="playerChoiceIcon">‚ùì</div>
                        </div>
                        <div class="vs-text">VS</div>
                        <div class="choice-box">
                            <div class="choice-label">Raqib</div>
                            <div class="choice-icon" id="opponentChoiceIcon">‚ùì</div>
                        </div>
                    </div>

                    <!-- TIMER -->
                    <div class="timer-container">
                        <div class="timer-circle">
                            <div class="timer" id="timer">30</div>
                        </div>
                    </div>

                    <!-- NATIJA -->
                    <div class="result-title" id="matchResultTitle">TANLOV QILING!</div>

                    <!-- TANLOV TUGMALARI -->
                    <div class="rps-buttons">
                        <button class="rps-btn rock-btn" id="rockBtn">
                            <span class="rps-icon">ü™®</span>
                            <span class="rps-label">Tosh</span>
                        </button>
                        <button class="rps-btn scissors-btn" id="scissorsBtn">
                            <span class="rps-icon">‚úÇÔ∏è</span>
                            <span class="rps-label">Qaychi</span>
                        </button>
                        <button class="rps-btn paper-btn" id="paperBtn">
                            <span class="rps-icon">üìÑ</span>
                            <span class="rps-label">Qog'oz</span>
                        </button>
                    </div>

                    <!-- O'TKAZISH TUGMASI -->
                    <button class="skip-btn" id="noBtn">
                        <i class="fas fa-forward"></i> O'tkazish
                    </button>

                    <!-- HOLAT XABARI -->
                    <div class="status-message" id="duelStatus" style="color: #ccc;">
                        Tosh, Qaychi yoki Qog'oz tanlang!
                    </div>
                </div>

                <!-- MATCH SCREEN -->
                <div class="match-screen hidden" id="matchScreen">
                    <div class="match-title" id="matchTitle">üéâ NATIJA!</div>
                    <div class="match-text" id="matchText">
                        <!-- Natija bu yerda ko'rsatiladi -->
                    </div>

                    <div class="rewards" id="matchRewards">
                        <div style="display: flex; justify-content: center; gap: 20px;">
                            <div><i class="fas fa-coins"></i> +<span id="rewardCoins">50</span></div>
                            <div><i class="fas fa-star"></i> +<span id="rewardXP">30</span> XP</div>
                        </div>
                    </div>

                    <div class="match-options" id="matchOptions"></div>
                </div>
            </div>

            <!-- PROFILE TAB -->
            <div class="tab-content" id="profileTab">
                <div class="profile-container">
                    <div class="profile-header">
                        <img src="" alt="Siz" class="profile-avatar" id="profileAvatar">
                        <div class="profile-info">
                            <h2 id="profileName">Foydalanuvchi</h2>
                            <p id="profileUsername">@username</p>
                            <p id="profileBio" style="font-size: 0.9rem; margin-top: 5px; color: #ccc;">Bio kiritilmagan</p>
                        </div>
                    </div>

                    <div class="profile-stats">
                        <div class="stat-card">
                            <div class="stat-value" id="statRating">1500</div>
                            <div class="stat-label">Reyting</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statGames">0</div>
                            <div class="stat-label">O'yinlar</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statWins">0</div>
                            <div class="stat-label">G'alaba</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statWinRate">0%</div>
                            <div class="stat-label">G'alaba %</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statWinStreak">0</div>
                            <div class="stat-label">Streak</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statFriends">0</div>
                            <div class="stat-label">Do'stlar</div>
                        </div>
                    </div>

                    <div class="profile-actions">
                        <button class="match-option-btn" id="editProfileBtn" style="margin-bottom: 10px;">
                            <i class="fas fa-edit"></i> Profilni Tahrirlash
                        </button>
                        <button class="match-option-btn" onclick="showRPSStatistics()" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); margin-bottom: 10px;">
                            <i class="fas fa-chart-bar"></i> Tosh-Qaychi-Qog'oz Statistikasi
                        </button>
                        <button class="match-option-btn" onclick="showDetailedStats()" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);">
                            <i class="fas fa-chart-pie"></i> Batafsil Statistika
                        </button>
                    </div>
                </div>

                <div class="quests-container">
                    <h3><i class="fas fa-tasks"></i> Kunlik Vazifalar</h3>
                    <div id="profileQuestsList"></div>
                </div>
            </div>

            <!-- FRIENDS TAB -->
            <div class="tab-content" id="friendsTab">
                <div class="friends-container">
                    <div id="friendsStatus">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div>
                                <div style="font-weight: bold; font-size: 1.1rem; color: #fff;">Do'stlar Ro'yxati</div>
                                <div style="font-size: 0.8rem; opacity: 0.8; color: #ccc;">
                                    <span id="friendsCount">0</span> ta do'st ‚Ä¢
                                    <span id="onlineFriendsCount">0</span> ta onlayn
                                </div>
                            </div>
                            <button class="refresh-btn" id="refreshFriendsBtn">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>

                    <div class="friend-list" id="friendsList"></div>

                    <div class="no-friends hidden" id="noFriends">
                        <div style="font-size: 3rem; margin-bottom: 15px;">üòî</div>
                        <div style="font-weight: bold; margin-bottom: 10px; color: #fff;">Hali do'stlaringiz yo'q</div>
                        <div style="opacity: 0.7; margin-bottom: 20px; color: #ccc;">O'zaro like bergan foydalanuvchilar bu yerda ko'rinadi</div>
                        <button class="start-btn" onclick="gameState.currentTab = 'duel'; showScreen('welcome');">
                            üéÆ Duel O'ynash
                        </button>
                    </div>
                </div>
            </div>

            <!-- SHOP TAB -->
            <div class="tab-content" id="shopTab">
                <div class="shop-container">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="color: #fff;"><i class="fas fa-shopping-cart"></i> Do'kon</h3>
                        <div class="stat-item" style="font-size: 1.1rem;">
                            <i class="fas fa-coins"></i>
                            <span id="shopCoinsCount">100</span>
                        </div>
                    </div>

                    <div class="shop-items" id="shopItemsList"></div>
                </div>
            </div>

            <!-- LEADERBOARD TAB -->
            <div class="tab-content" id="leaderboardTab">
                <div class="leaderboard-container">
                    <h3 style="color: #fff;"><i class="fas fa-trophy"></i> Liderlar Doskasi</h3>

                    <div class="leaderboard-tabs">
                        <div class="leaderboard-tab active" data-leaderboard="rating">Reyting</div>
                        <div class="leaderboard-tab" data-leaderboard="wins">G'alabalar</div>
                        <div class="leaderboard-tab" data-leaderboard="streak">Streak</div>
                    </div>

                    <div class="leaderboard-list" id="leaderboardList"></div>

                    <div class="leaderboard-updated" style="color: #ccc;">
                        Yangilangan: <span id="leaderboardUpdated">hozir</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL KONTEYNERI -->
    <div id="modalContainer"></div>

    <!-- GENDER MODALI -->
    <div class="gender-modal mandatory-modal" id="genderModal">
        <div class="modal-content">
            <div style="font-size: 3rem; margin-bottom: 15px;">üë§</div>
            <h2 style="margin-bottom: 10px; color: #fff;">‚ö†Ô∏è MAJBURIY: Jinsni Tanlang</h2>
            <p style="margin-bottom: 20px; opacity: 0.7; color: #e74c3c; font-weight: bold;">
                Gender tanlamasangiz duel o'ynay olmaysiz!
            </p>
            <p style="margin-bottom: 20px; opacity: 0.7; color: #ccc;">
                Bu sizning duel qilish sozlamangiz. Keyinchalik profil orqali o'zgartirishingiz mumkin.
            </p>

            <div class="gender-options">
                <button class="gender-option-btn gender-male" id="selectMaleBtn">
                    <i class="fas fa-mars"></i>
                    <div style="text-align: left; flex: 1;">
                        <div style="font-weight: bold;">Erkak</div>
                        <div style="font-size: 0.8rem; opacity: 0.9;">Faqat ayollar bilan duel</div>
                    </div>
                </button>

                <button class="gender-option-btn gender-female" id="selectFemaleBtn">
                    <i class="fas fa-venus"></i>
                    <div style="text-align: left; flex: 1;">
                        <div style="font-weight: bold;">Ayol</div>
                        <div style="font-size: 0.8rem; opacity: 0.9;">Faqat erkaklar bilan duel</div>
                    </div>
                </button>

                <button class="gender-option-btn gender-all" id="selectAllBtn">
                    <i class="fas fa-users"></i>
                    <div style="text-align: left; flex: 1;">
                        <div style="font-weight: bold;">Hammasi</div>
                        <div style="font-size: 0.8rem; opacity: 0.9;">Har qanday jins bilan duel</div>
                    </div>
                </button>
            </div>

            <div style="margin-top: 20px; padding: 10px; background: rgba(255, 255, 255, 0.05); border-radius: 10px;">
                <p style="font-size: 0.8rem; opacity: 0.7; margin: 0; color: #ccc;">
                    <i class="fas fa-info-circle"></i> Eslatma: Gender tanlaganingizdan keyin o'zgartirishingiz mumkin,
                    lekin duel qilish uchun gender tanlash MAJBURIY!
                </p>
            </div>
        </div>
    </div>

    <!-- PROFIL TAXRIRLASH MODALI -->
    <div class="modal" id="profileEditModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Profilni Tahrirlash</h2>
                <button class="close-btn" onclick="closeProfileEdit()">√ó</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #fff;">Bio</label>
                    <textarea id="editBio" placeholder="O'zingiz haqingizda yozing..." rows="4" style="background: rgba(255, 255, 255, 0.1); color: #fff; border: 1px solid rgba(255, 255, 255, 0.2); width: 100%; padding: 10px; border-radius: 8px;"></textarea>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #fff;">Jins</label>
                    <select id="editGender" style="background: rgba(255, 255, 255, 0.1); color: #fff; border: 1px solid rgba(255, 255, 255, 0.2); width: 100%; padding: 10px; border-radius: 8px;">
                        <option value="not_specified">Ko'rsatilmaydi (hamma bilan)</option>
                        <option value="male">Erkak (faqat ayollar bilan)</option>
                        <option value="female">Ayol (faqat erkaklar bilan)</option>
                    </select>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #fff;">Filter</label>
                    <select id="editFilter" style="background: rgba(255, 255, 255, 0.1); color: #fff; border: 1px solid rgba(255, 255, 255, 0.2); width: 100%; padding: 10px; border-radius: 8px;">
                        <option value="not_specified">Hamma bilan duel</option>
                        <option value="male">Faqat erkaklar bilan</option>
                        <option value="female">Faqat ayollar bilan</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button id="saveProfileBtn" class="btn btn-primary">Saqlash</button>
                <button onclick="closeProfileEdit()" class="btn btn-secondary">Bekor qilish</button>
            </div>
        </div>
    </div>

    <!-- QOIDALAR MODALI -->
    <div class="modal" id="rulesModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Tosh-Qaychi-Qog'oz Qoidalari</h2>
                <button class="close-btn" onclick="hideRulesModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="rules-content">
                    <div class="rule-item">
                        <div class="rule-icon">ü™®</div>
                        <div class="rule-text">
                            <h3>Tosh (ü™®)</h3>
                            <p>Qaychini sindiradi</p>
                        </div>
                    </div>
                    <div class="rule-item">
                        <div class="rule-icon">‚úÇÔ∏è</div>
                        <div class="rule-text">
                            <h3>Qaychi (‚úÇÔ∏è)</h3>
                            <p>Qog'ozni kesadi</p>
                        </div>
                    </div>
                    <div class="rule-item">
                        <div class="rule-icon">üìÑ</div>
                        <div class="rule-text">
                            <h3>Qog'oz (üìÑ)</h3>
                            <p>Toshni o'rab oladi</p>
                        </div>
                    </div>
                    <div class="rule-diagram">
                        <div class="diagram-row">
                            <div class="diagram-item">ü™®</div>
                            <div class="diagram-arrow">‚Üí</div>
                            <div class="diagram-item">‚úÇÔ∏è</div>
                        </div>
                        <div class="diagram-row">
                            <div class="diagram-item">‚úÇÔ∏è</div>
                            <div class="diagram-arrow">‚Üí</div>
                            <div class="diagram-item">üìÑ</div>
                        </div>
                        <div class="diagram-row">
                            <div class="diagram-item">üìÑ</div>
                            <div class="diagram-arrow">‚Üí</div>
                            <div class="diagram-item">ü™®</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="hideRulesModal()" class="btn btn-primary">Tushunarli</button>
            </div>
        </div>
    </div>

    <!-- STATISTIKA MODALI -->
    <div class="modal" id="statsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Batafsil Statistika</h2>
                <button class="close-btn" onclick="closeStatsModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div id="detailedStatsContent">
                    <!-- Statistika bu yerda ko'rsatiladi -->
                </div>
            </div>
        </div>
    </div>

    <!-- SOZLAMALAR MODALI -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Sozlamalar</h2>
                <button class="close-btn" onclick="closeSettings()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="setting-item">
                    <label>
                        <input type="checkbox" id="soundToggle">
                        <span>Tovushlar</span>
                    </label>
                </div>
                <div class="setting-item">
                    <label>
                        <input type="checkbox" id="vibrationToggle">
                        <span>Vibratsiya</span>
                    </label>
                </div>
                <div class="setting-item">
                    <label>
                        <input type="checkbox" id="notificationsToggle">
                        <span>Bildirishnomalar</span>
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button id="saveSettingsBtn" class="btn btn-primary">Saqlash</button>
            </div>
        </div>
    </div>

    <!-- NOTIFIKATSIYA -->
    <div class="notification" id="notification">
        <div id="notificationTitle" style="font-weight: bold; margin-bottom: 5px; color: #fff;"></div>
        <div id="notificationMessage" style="color: #ccc;"></div>
    </div>

    <!-- LEVEL UP NOTIFIKATSIYA -->
    <div class="level-up-notification" id="levelUpNotification" style="display: none;">
        <div class="level-up-content">
            <div class="level-up-icon">üéâ</div>
            <div class="level-up-text">
                <h3>LEVEL UP!</h3>
                <p id="levelUpText">1 ‚Üí 2</p>
                <p class="level-up-reward">100 coin bonus!</p>
            </div>
        </div>
    </div>

    <!-- STREAK NOTIFIKATSIYA -->
    <div class="streak-notification" id="streakNotification" style="display: none;">
        <div class="streak-content">
            <div class="streak-icon">üî•</div>
            <div class="streak-text">
                <h3 id="streakTitle">3 KETMA-KET G'ALABA!</h3>
                <p id="streakMessage">Streak bonus: 15 coin qo'shildi!</p>
            </div>
        </div>
    </div>

    <!-- ACHIEVEMENT NOTIFIKATSIYA -->
    <div class="achievement-notification" id="achievementNotification" style="display: none;">
        <div class="achievement-content">
            <div class="achievement-icon" id="achievementIcon">üèÜ</div>
            <div class="achievement-text">
                <h3>Achievement Ochildi!</h3>
                <p id="achievementTitle">Birinchi G'alaba</p>
                <p id="achievementReward">200 coin qo'shildi!</p>
            </div>
        </div>
    </div>

    <script src="main.js"></script>
</body>
</html>