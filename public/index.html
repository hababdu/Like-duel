<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‚ù§Ô∏è Like Duel - O'zaro Match va Do'stlar Tizimi</title>
    
    <!-- CDN kutubxonalari -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Mahalliy fayllar -->
    <link rel="stylesheet" href="style.css">
    <style>
        /* Gift Modal Styling */
        .gift-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .gift-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .gift-modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 20px;
            border: 2px solid #667eea;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        }

        .gift-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .gift-modal-header h2 {
            color: #fff;
            font-size: 1.5rem;
            margin: 0;
        }

        .gift-close-btn {
            background: none;
            border: none;
            color: #fff;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
        }

        .gift-receiver-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(102, 126, 234, 0.3);
        }

        .gift-receiver-info img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid #667eea;
        }

        .gift-receiver-details h3 {
            color: #fff;
            margin: 0 0 5px 0;
            font-size: 1.2rem;
        }

        .gift-receiver-details p {
            color: #ccc;
            margin: 0;
            font-size: 0.9rem;
        }

        .gifts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .gift-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 120px;
        }

        .gift-item:hover {
            transform: translateY(-5px);
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .gift-item.selected {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.2);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .gift-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .gift-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
            line-height: 1;
        }

        .gift-name {
            color: #fff;
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .gift-price {
            color: #f1c40f;
            font-weight: bold;
            font-size: 1rem;
        }

        .gift-balance {
            text-align: center;
            padding: 15px;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(241, 196, 15, 0.3);
        }

        .gift-balance p {
            color: #fff;
            margin: 0;
            font-size: 1.1rem;
        }

        .gift-balance span {
            color: #f1c40f;
            font-weight: bold;
        }

        .confirm-gift-btn {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .confirm-gift-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }

        .confirm-gift-btn:disabled {
            background: linear-gradient(135deg, #7f8c8d 0%, #95a5a6 100%);
            cursor: not-allowed;
            transform: none;
        }

        .gift-history-btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 0.9rem;
            cursor: pointer;
            margin-top: 15px;
            width: 100%;
        }

        /* Gift Notification */
        .gift-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 9999;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            max-width: 350px;
        }

        .gift-notification.show {
            transform: translateX(0);
        }

        .gift-notification-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .gift-icon-large {
            font-size: 2.5rem;
        }

        .gift-notification-text h3 {
            margin: 0 0 5px 0;
            font-size: 1.1rem;
        }

        .gift-notification-text p {
            margin: 0;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Modal Overlay */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Gift History Modal */
        .gift-history-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10001;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .gift-history-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .gift-history-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 25px;
            border: 2px solid #9b59b6;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        }

        .gift-history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .gift-history-header h2 {
            color: #fff;
            font-size: 1.5rem;
            margin: 0;
        }

        .gift-history-section {
            margin-bottom: 30px;
        }

        .gift-history-section h3 {
            color: #fff;
            margin-bottom: 15px;
            font-size: 1.2rem;
            padding-left: 10px;
            border-left: 4px solid #667eea;
        }

        .gift-history-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .gift-history-item.received {
            border-left-color: #2ecc71;
        }

        .gift-history-icon {
            font-size: 2rem;
        }

        .gift-history-info {
            flex: 1;
        }

        .gift-history-name {
            color: #fff;
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 1rem;
        }

        .gift-history-receiver,
        .gift-history-sender {
            color: #ccc;
            font-size: 0.85rem;
            margin-bottom: 3px;
        }

        .gift-history-time {
            color: #95a5a6;
            font-size: 0.8rem;
        }

        .gift-history-price {
            color: #e74c3c;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .empty-history {
            text-align: center;
            padding: 30px;
            color: #ccc;
            font-size: 1rem;
        }

        .empty-history i {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
        }

        /* Responsive Design */
        @media (max-width: 480px) {
            .gifts-grid {
                grid-template-columns: 1fr;
            }
            
            .gift-modal-content {
                width: 95%;
                padding: 15px;
            }
            
            .gift-receiver-info {
                padding: 12px;
            }
            
            .gift-receiver-info img {
                width: 50px;
                height: 50px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- NAVIGATION TABS (PASTDA) -->
        <div class="nav-tabs-bottom">
            <div class="nav-tab active" data-tab="duel">
                <i class="fas fa-gamepad"></i>
                <span>Duel</span>
            </div>
            <div class="nav-tab" data-tab="profile">
                <i class="fas fa-user"></i>
                <span>Profil</span>
            </div>
            <div class="nav-tab" data-tab="friends">
                <i class="fas fa-users"></i>
                <span>Do'stlar</span>
            </div>
            <div class="nav-tab" data-tab="shop">
                <i class="fas fa-shopping-cart"></i>
                <span>Do'kon</span>
            </div>
            <div class="nav-tab" data-tab="leaderboard">
                <i class="fas fa-trophy"></i>
                <span>Liderlar</span>
            </div>
        </div>

        <!-- ASOSIY KONTENT -->
        <div class="main-content">
            <!-- HEADER -->
            <div class="app-header">
                <div class="header-title">
                    <i class="fas fa-heart"></i>
                    <span>Like Duel</span>
                </div>
                <div class="header-stats">
                    <div class="stat-item" id="coinsStat">
                        <i class="fas fa-coins"></i>
                        <span id="coinsCount">100</span>
                    </div>
                    <div class="stat-item" id="levelStat">
                        <i class="fas fa-star"></i>
                        <span id="levelCount">1</span>
                    </div>
                </div>
            </div>

            <!-- DUEL TAB -->
            <div class="tab-content active" id="duelTab">
                <!-- WELCOME SCREEN -->
                <div class="duel-container" id="welcomeScreen">
                    <div class="profile-card" id="profileCard">
                        <img src="" alt="Siz" class="profile-avatar" id="myAvatar">
                        <div class="profile-name" id="myName">Foydalanuvchi</div>
                        <div class="profile-username" id="myUsername">@username</div>

                        <div class="stats" style="display: flex; justify-content: space-around; margin: 20px 0;">
                            <div class="stat">
                                <div class="stat-value" id="myMatches">0</div>
                                <div class="stat-label">Matchlar</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value" id="mutualMatchesCount">0</div>
                                <div class="stat-label">O'zaro Match</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value" id="myLikes">0</div>
                                <div class="stat-label">Likelar</div>
                            </div>
                        </div>

                        <!-- Gender Filter -->
                        <div id="genderFilterContainer"></div>

                        <!-- IKKITA ASOSIY TUGMA -->
                        <div class="action-buttons">
                            <button id="startBtn" class="start-btn">
                                üîó Serverga Ulanish
                            </button>
                            <button id="enterQueueBtn" class="start-btn" disabled>
                                Navbatga kirish
                            </button>
                        </div>

                        <!-- QO'SHIMCHA TUGMALAR -->
                        <div class="additional-actions">
                            <button class="secondary-btn" onclick="showGenderModal(true)">
                                <i class="fas fa-venus-mars"></i> 
                            </button>
                            <button class="secondary-btn" id="editProfileBtn">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="secondary-btn" id="viewStatsBtn">
                                <i class="fas fa-chart-bar"></i>
                            </button>
                            <button class="secondary-btn" onclick="showGiftHistory()" title="Sovg'a tarixi">
                                <i class="fas fa-gift"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- QUEUE SCREEN -->
                <div class="duel-container hidden" id="queueScreen">
                    <div class="loader"></div>
                    <div class="waiting-info" style="font-size: 1.2rem; margin-bottom: 15px; color: #fff;">Navbat kutish...</div>
                    <div class="waiting-count" id="waitingCount">0</div>
                    <div class="position-info" id="positionInfo">
                        Sizning o'rningiz: <span id="position">-</span>
                    </div>
                    <div class="status-message" id="queueStatus" style="color: #ccc;">
                        Serverga ulanmoqda...
                    </div>

                    <div class="gender-warning hidden" id="genderWarning">
                        <div class="gender-warning-content">
                            <i class="fas fa-exclamation-triangle"></i>
                            <div>
                                <div style="font-weight: bold; font-size: 1.1rem; color: #e74c3c;">Gender tanlanmagan!</div>
                                <div style="color: #ccc;">Duel qilish uchun gender tanlashingiz kerak</div>
                            </div>
                        </div>
                        <button id="selectGenderNowBtn" class="gender-select-btn">
                            <i class="fas fa-user-edit"></i> Hozir tanlash
                        </button>
                    </div>

                    <button class="start-btn" id="leaveQueueBtn" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); margin-top: 20px;">
                        üö™ Navbatdan Chiqish
                    </button>
                </div>

                <!-- DUEL SCREEN -->
                <div class="duel-container hidden" id="duelScreen">
                    <img src="" alt="Raqib" class="opponent-avatar" id="opponentAvatar">
                    <div class="opponent-info">
                        <div class="opponent-name" id="opponentName">Raqib</div>
                        <div class="opponent-username" id="opponentUsername">@username</div>

                        <div class="opponent-stats">
                            <span><i class="fas fa-trophy"></i> <span id="opponentRating">1500</span></span>
                            <span><i class="fas fa-heart"></i> <span id="opponentMatches">0</span></span>
                            <span><i class="fas fa-level-up-alt"></i> <span id="opponentLevel">1</span></span>
                        </div>
                    </div>

                    <div class="super-like-indicator" id="superLikeIndicator">
                        <i class="fas fa-gem"></i>
                        Kunlik SUPER LIKE: <span id="superLikeCount">3</span> ta qoldi
                    </div>

                    <div class="timer-container">
                        <div class="timer-circle">
                            <div class="timer" id="timer">‚àû</div>
                        </div>
                    </div>

                    <div class="vote-container">
                        <div class="vote-buttons" id="voteButtons">
                            <div class="vote-btn-group">
                                <button class="vote-btn btn-no" id="noBtn">‚úñ</button>
                                <div class="vote-label">O'tkazish</div>
                            </div>
                            <div class="vote-btn-group">
                                <button class="vote-btn btn-like" id="likeBtn">‚ù§Ô∏è</button>
                                <div class="vote-label">Like</div>
                            </div>
                            <div class="vote-btn-group">
                                <button class="vote-btn btn-super-like" id="superLikeBtn">üíñ</button>
                                <div class="vote-label">Super Like</div>
                            </div>
                        </div>
                    </div>

                    <div class="status-message" id="duelStatus" style="color: #ccc;">
                        Ovoz bering: ‚ù§Ô∏è yoki üíñ yoki ‚úñ
                    </div>
                </div>

                <!-- MATCH SCREEN -->
                <div class="match-screen hidden" id="matchScreen">
                    <div class="match-title">üéâ MATCH!</div>
                    <div class="match-text" id="matchText">
                        <span id="partnerName">Foydalanuvchi</span> bilan suhbatlashish
                    </div>

                    <div class="rewards" id="matchRewards">
                        <div style="display: flex; justify-content: center; gap: 20px;">
                            <div><i class="fas fa-coins"></i> +<span id="rewardCoins">50</span></div>
                            <div><i class="fas fa-star"></i> +<span id="rewardXP">30</span> XP</div>
                            <div><i class="fas fa-users"></i> <span style="color: #fff;">DO'ST BO'LDINGIZ!</span></div>
                        </div>
                    </div>

                    <div class="match-options" id="matchOptions"></div>
                </div>
            </div>

            <!-- PROFILE TAB -->
            <div class="tab-content" id="profileTab">
                <div class="profile-container">
                    <div class="profile-header">
                        <img src="" alt="Siz" class="profile-avatar" id="profileAvatar">
                        <div class="profile-info">
                            <h2 id="profileName">Foydalanuvchi</h2>
                            <p id="profileUsername">@username</p>
                            <p id="profileBio" style="font-size: 0.9rem; margin-top: 5px; color: #ccc;">Bio kiritilmagan</p>
                        </div>
                    </div>

                    <div class="profile-stats">
                        <div class="stat-card">
                            <div class="stat-value" id="statRating">1500</div>
                            <div class="stat-label">Reyting</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statMatches">0</div>
                            <div class="stat-label">Matchlar</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statDuels">0</div>
                            <div class="stat-label">Duellar</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="mutualMatchesProfile">0</div>
                            <div class="stat-label">O'zaro Match</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statWinRate">0%</div>
                            <div class="stat-label">G'alaba %</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statFriends">0</div>
                            <div class="stat-label">Do'stlar</div>
                        </div>
                    </div>

                    <div class="profile-actions">
                        <button class="match-option-btn" id="editProfileBtn" style="margin-bottom: 10px;">
                            <i class="fas fa-edit"></i> Profilni Tahrirlash
                        </button>
                        <button class="match-option-btn" id="viewStatsBtn" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); margin-bottom: 10px;">
                            <i class="fas fa-chart-bar"></i> Batafsil Statistika
                        </button>
                        <button class="match-option-btn" onclick="showGiftHistory()" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);">
                            <i class="fas fa-gift"></i> Sovg'a Tarixi
                        </button>
                    </div>
                </div>

                <div class="quests-container">
                    <h3><i class="fas fa-tasks"></i> Kunlik Vazifalar</h3>
                    <div id="profileQuestsList"></div>
                </div>
            </div>

            <!-- FRIENDS TAB -->
            <div class="tab-content" id="friendsTab">
                <div class="friends-container">
                    <div id="friendsStatus">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div>
                                <div style="font-weight: bold; font-size: 1.1rem; color: #fff;">Do'stlar Ro'yxati</div>
                                <div style="font-size: 0.8rem; opacity: 0.8; color: #ccc;">
                                    <span id="friendsCount">0</span> ta do'st ‚Ä¢
                                    <span id="onlineFriendsCount">0</span> ta onlayn
                                </div>
                            </div>
                            <button class="refresh-btn" id="refreshFriendsBtn">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>

                    <div class="friend-list" id="friendsList"></div>

                    <div class="no-friends hidden" id="noFriends">
                        <div style="font-size: 3rem; margin-bottom: 15px;">üòî</div>
                        <div style="font-weight: bold; margin-bottom: 10px; color: #fff;">Hali do'stlaringiz yo'q</div>
                        <div style="opacity: 0.7; margin-bottom: 20px; color: #ccc;">O'zaro like bergan foydalanuvchilar bu yerda ko'rinadi</div>
                        <button class="start-btn" onclick="gameState.currentTab = 'duel'; showScreen('welcome');">
                            üéÆ Duel O'ynash
                        </button>
                    </div>
                </div>
            </div>

            <!-- SHOP TAB -->
            <div class="tab-content" id="shopTab">
                <div class="shop-container">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="color: #fff;"><i class="fas fa-shopping-cart"></i> Do'kon</h3>
                        <div class="stat-item" style="font-size: 1.1rem;">
                            <i class="fas fa-coins"></i>
                            <span id="shopCoinsCount">100</span>
                        </div>
                    </div>

                    <div class="shop-items" id="shopItemsList"></div>
                </div>
            </div>

            <!-- LEADERBOARD TAB -->
            <div class="tab-content" id="leaderboardTab">
                <div class="leaderboard-container">
                    <h3 style="color: #fff;"><i class="fas fa-trophy"></i> Liderlar Doskasi</h3>

                    <div class="leaderboard-tabs">
                        <div class="leaderboard-tab active" data-leaderboard="rating">Reyting</div>
                        <div class="leaderboard-tab" data-leaderboard="matches">Matchlar</div>
                        <div class="leaderboard-tab" data-leaderboard="friends">Do'stlar</div>
                    </div>

                    <div class="leaderboard-list" id="leaderboardList"></div>

                    <div class="leaderboard-updated" style="color: #ccc;">
                        Yangilangan: <span id="leaderboardUpdated">hozir</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SOVG'A YUBORISH MODALI -->
    <div class="gift-modal" id="giftModal">
        <div class="gift-modal-content">
            <div class="gift-modal-header">
                <h2>üéÅ Sovg'a yuborish</h2>
                <button class="gift-close-btn" onclick="closeGiftModal()">√ó</button>
            </div>
            
            <div class="modal-body">
                <div class="gift-receiver-info">
                    <img id="giftReceiverAvatar" src="" alt="">
                    <div class="gift-receiver-details">
                        <h3 id="giftReceiverName">Foydalanuvchi</h3>
                        <p id="giftReceiverUsername">@username</p>
                    </div>
                </div>
                
                <p style="color: #ccc; margin-bottom: 15px; text-align: center;">Quyidagi sovg'alardan birini tanlang:</p>
                
                <div class="gifts-grid" id="giftsGrid">
                    <!-- Sovg'alar bu yerda JavaScript orqali yuklanadi -->
                </div>
                
                <div class="gift-balance">
                    <p>üí≥ Mavjud coinlar: <span id="giftBalanceCoins">0</span> <i class="fas fa-coins" style="color: #f1c40f;"></i></p>
                </div>
                
                <button class="gift-history-btn" onclick="showGiftHistory()">
                    <i class="fas fa-history"></i> Sovg'a tarixini ko'rish
                </button>
            </div>
        </div>
    </div>

    <!-- SOVG'A TARIXI MODALI -->
    <div class="gift-history-modal" id="giftHistoryModal">
        <div class="gift-history-content">
            <div class="gift-history-header">
                <h2>üìú Sovg'a tarixi</h2>
                <button class="gift-close-btn" onclick="closeGiftHistoryModal()">√ó</button>
            </div>
            
            <div class="modal-body">
                <div class="gift-history-section">
                    <h3><i class="fas fa-paper-plane"></i> Yuborilgan sovg'alar</h3>
                    <div id="sentGiftsList">
                        <!-- Yuborilgan sovg'alar -->
                    </div>
                </div>
                
                <div class="gift-history-section">
                    <h3><i class="fas fa-gift"></i> Qabul qilingan sovg'alar</h3>
                    <div id="receivedGiftsList">
                        <!-- Qabul qilingan sovg'alar -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Gender tanlash (majburiy) -->
    <div class="gender-modal mandatory-modal" id="genderModal">
        <div class="modal-content">
            <div style="font-size: 3rem; margin-bottom: 15px;">üë§</div>
            <h2 style="margin-bottom: 10px; color: #fff;">‚ö†Ô∏è MAJBURIY: Jinsni Tanlang</h2>
            <p style="margin-bottom: 20px; opacity: 0.7; color: #e74c3c; font-weight: bold;">
                Gender tanlamasangiz duel o'ynay olmaysiz!
            </p>
            <p style="margin-bottom: 20px; opacity: 0.7; color: #ccc;">
                Bu sizning duel qilish sozlamangiz. Keyinchalik profil orqali o'zgartirishingiz mumkin.
            </p>

            <div class="gender-options">
                <button class="gender-option-btn gender-male" id="selectMaleBtn">
                    <i class="fas fa-mars"></i>
                    <div style="text-align: left; flex: 1;">
                        <div style="font-weight: bold;">Erkak</div>
                        <div style="font-size: 0.8rem; opacity: 0.9;">Faqat ayollar bilan duel</div>
                    </div>
                </button>

                <button class="gender-option-btn gender-female" id="selectFemaleBtn">
                    <i class="fas fa-venus"></i>
                    <div style="text-align: left; flex: 1;">
                        <div style="font-weight: bold;">Ayol</div>
                        <div style="font-size: 0.8rem; opacity: 0.9;">Faqat erkaklar bilan duel</div>
                    </div>
                </button>

                <button class="gender-option-btn gender-all" id="selectAllBtn">
                    <i class="fas fa-users"></i>
                    <div style="text-align: left; flex: 1;">
                        <div style="font-weight: bold;">Hammasi</div>
                        <div style="font-size: 0.8rem; opacity: 0.9;">Har qanday jins bilan duel</div>
                    </div>
                </button>
            </div>

            <div style="margin-top: 20px; padding: 10px; background: rgba(255, 255, 255, 0.05); border-radius: 10px;">
                <p style="font-size: 0.8rem; opacity: 0.7; margin: 0; color: #ccc;">
                    <i class="fas fa-info-circle"></i> Eslatma: Gender tanlaganingizdan keyin o'zgartirishingiz mumkin,
                    lekin duel qilish uchun gender tanlash MAJBURIY!
                </p>
            </div>
        </div>
    </div>

    <!-- Profil tahrirlash -->
    <div class="chat-modal" id="profileEditModal">
        <div class="chat-box">
            <div class="chat-header">
                <div style="color: #fff;">Profilni Tahrirlash</div>
                <button id="closeProfileEditBtn"><i class="fas fa-times" style="color: #fff;"></i></button>
            </div>
            <div class="chat-messages" style="height: auto; padding: 20px;">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #fff;">Bio</label>
                    <textarea id="editBio" placeholder="O'zingiz haqingizda yozing..." rows="4" style="background: rgba(255, 255, 255, 0.1); color: #fff; border: 1px solid rgba(255, 255, 255, 0.2);"></textarea>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #fff;">Jins</label>
                    <select id="editGender" style="background: rgba(255, 255, 255, 0.1); color: #fff; border: 1px solid rgba(255, 255, 255, 0.2);">
                        <option value="not_specified">Ko'rsatilmaydi (hamma bilan)</option>
                        <option value="male">Erkak (faqat ayollar bilan)</option>
                        <option value="female">Ayol (faqat erkaklar bilan)</option>
                    </select>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #fff;">Filter</label>
                    <select id="editFilter" style="background: rgba(255, 255, 255, 0.1); color: #fff; border: 1px solid rgba(255, 255, 255, 0.2);">
                        <option value="not_specified">Hamma bilan duel</option>
                        <option value="male">Faqat erkaklar bilan</option>
                        <option value="female">Faqat ayollar bilan</option>
                    </select>
                </div>
                <button id="saveProfileBtn" style="background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); color: #fff;">Saqlash</button>
            </div>
        </div>
    </div>

    <!-- Chat modal -->
    <div class="chat-modal" id="chatModal">
        <div class="chat-box">
            <div class="chat-header">
                <div id="chatTitle" style="color: #fff;">Telegram Chat</div>
                <button id="closeChatBtn"><i class="fas fa-times" style="color: #fff;"></i></button>
            </div>
            <div class="chat-content">
                <img src="" alt="" class="chat-avatar" id="chatPartnerAvatar">
                <div class="chat-name" id="chatPartnerName">Foydalanuvchi</div>
                <div class="chat-username" id="chatUsername">@username</div>

                <button class="chat-button" id="chatOpenTelegramBtn">
                    <i class="fab fa-telegram"></i> Telegramda ochish
                </button>

                <div class="chat-note">
                    <p style="color: #ccc;"><i class="fas fa-info-circle"></i> Match bo'lganingiz uchun endi bir-biringiz bilan bemalol suhbatlashingiz mumkin!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <div id="notificationTitle" style="font-weight: bold; margin-bottom: 5px; color: #fff;"></div>
        <div id="notificationMessage" style="color: #ccc;"></div>
    </div>

    <script>
        // Sovg'a modalini ochish funksiyasi
        function openGiftModal(receiver) {
            if (!receiver) {
                console.error('Receiver not provided');
                return;
            }
            
            console.log('Opening gift modal for:', receiver);
            
            // Modal elementlarini topish
            const modal = document.getElementById('giftModal');
            const avatar = document.getElementById('giftReceiverAvatar');
            const name = document.getElementById('giftReceiverName');
            const username = document.getElementById('giftReceiverUsername');
            const balance = document.getElementById('giftBalanceCoins');
            const grid = document.getElementById('giftsGrid');
            
            if (!modal || !avatar || !name || !username || !balance || !grid) {
                console.error('Gift modal elements not found');
                return;
            }
            
            // Receiver ma'lumotlarini to'ldirish
            avatar.src = receiver.photo || `https://ui-avatars.com/api/?name=${receiver.name || 'User'}&background=667eea&color=fff`;
            name.textContent = receiver.name || 'Foydalanuvchi';
            username.textContent = receiver.username ? `@${receiver.username}` : '';
            
            // Coin balance
            const userCoins = parseInt(localStorage.getItem('userCoins')) || 100;
            balance.textContent = userCoins;
            
            // Sovg'alarni yuklash
            loadGiftsToModal(grid, userCoins, receiver);
            
            // Modalni ochish
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function closeGiftModal() {
            const modal = document.getElementById('giftModal');
            if (modal) {
                modal.classList.remove('active');
            }
            document.body.style.overflow = 'auto';
        }
        
        function closeGiftHistoryModal() {
            const modal = document.getElementById('giftHistoryModal');
            if (modal) {
                modal.classList.remove('active');
            }
            document.body.style.overflow = 'auto';
        }
        
        function loadGiftsToModal(gridElement, userCoins, receiver) {
            const gifts = [
                { id: 1, name: 'Virtual Gul', price: 10, icon: 'üåπ', description: 'Sevgi ramzi' },
                { id: 2, name: 'Yulduz', price: 25, icon: '‚≠ê', description: 'Yorqin yulduz' },
                { id: 3, name: 'Sevgi Qalbi', price: 50, icon: 'üíù', description: 'Maxsus sevgi' },
                { id: 4, name: 'Tog\' Gozali', price: 100, icon: 'üèîÔ∏è', description: 'O\'zbekiston gozali' },
                { id: 5, name: 'Paxta Gullari', price: 150, icon: 'üå∏', description: 'O\'zbekiston ramzi' },
                { id: 6, name: 'Kumush', price: 200, icon: 'ü•à', description: 'Kumush sovg\'a' },
                { id: 7, name: 'Oltin', price: 500, icon: 'ü•á', description: 'Oltin sovg\'a' },
                { id: 8, name: 'Diamond', price: 1000, icon: 'üíé', description: 'Eng qimmat sovg\'a' }
            ];
            
            gridElement.innerHTML = '';
            
            gifts.forEach(gift => {
                const canAfford = userCoins >= gift.price;
                const giftElement = document.createElement('div');
                giftElement.className = `gift-item ${canAfford ? '' : 'disabled'}`;
                giftElement.innerHTML = `
                    <div class="gift-icon">${gift.icon}</div>
                    <div class="gift-name">${gift.name}</div>
                    <div class="gift-price">${gift.price} coin</div>
                `;
                
                if (canAfford) {
                    giftElement.addEventListener('click', () => {
                        selectGift(gift, receiver);
                    });
                }
                
                gridElement.appendChild(giftElement);
            });
        }
        
        function selectGift(gift, receiver) {
            console.log('Selected gift:', gift, 'for receiver:', receiver);
            
            // Oldingi tanlangan sovg'ani olib tashlash
            const selectedItems = document.querySelectorAll('.gift-item.selected');
            selectedItems.forEach(item => item.classList.remove('selected'));
            
            // Yangi sovg'ani tanlash
            const giftItems = document.querySelectorAll('.gift-item');
            giftItems.forEach(item => {
                if (item.querySelector('.gift-name').textContent === gift.name) {
                    item.classList.add('selected');
                }
            });
            
            // Tasdiqlash tugmasini yaratish/yangilash
            let confirmBtn = document.querySelector('.confirm-gift-btn');
            if (!confirmBtn) {
                confirmBtn = document.createElement('button');
                confirmBtn.className = 'confirm-gift-btn';
                document.querySelector('.modal-body').appendChild(confirmBtn);
            }
            
            confirmBtn.innerHTML = `‚úÖ ${gift.price} coin evaziga sovg'a yuborish`;
            confirmBtn.onclick = () => sendGift(gift, receiver);
        }
        
        function sendGift(gift, receiver) {
            console.log('Sending gift:', gift, 'to:', receiver);
            
            // Bu yerda serverga so'rov yuboriladi
            // Hozircha test rejimida ishlatamiz
            const userCoins = parseInt(localStorage.getItem('userCoins')) || 100;
            
            if (userCoins >= gift.price) {
                // Coinlarni kamaytirish
                const newCoins = userCoins - gift.price;
                localStorage.setItem('userCoins', newCoins.toString());
                
                // UI ni yangilash
                document.getElementById('giftBalanceCoins').textContent = newCoins;
                if (document.getElementById('coinsCount')) {
                    document.getElementById('coinsCount').textContent = newCoins;
                }
                
                // Sovg'ani yuborish haqida bildirishnoma
                showGiftNotification({
                    sender: { name: 'Siz' },
                    gift: { name: gift.name, icon: gift.icon },
                    receiver: { name: receiver.name }
                });
                
                // Sovg'a tarixiga qo'shish
                saveGiftToHistory(gift, receiver, 'sent');
                
                // Modalni yopish
                closeGiftModal();
                
                // Bildirishnoma
                showNotification('üéÅ Sovg\'a yuborildi!', 
                    `${receiver.name} ga ${gift.name} sovg'asini yubordingiz!`);
            } else {
                showNotification('Xato', 'Coinlaringiz yetarli emas!');
            }
        }
        
        function showGiftNotification(data) {
            const notification = document.createElement('div');
            notification.className = 'gift-notification';
            notification.innerHTML = `
                <div class="gift-notification-content">
                    <div class="gift-icon-large">${data.gift.icon}</div>
                    <div class="gift-notification-text">
                        <h3>üéÅ Sovg'a yuborildi!</h3>
                        <p>${data.sender.name} ${data.receiver.name} ga ${data.gift.name} sovg'asini yubordi!</p>
                    </div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 5000);
        }
        
        function saveGiftToHistory(gift, receiver, type) {
            const historyKey = type === 'sent' ? 'sentGifts' : 'receivedGifts';
            let history = JSON.parse(localStorage.getItem(historyKey)) || [];
            
            history.unshift({
                gift: gift,
                [type === 'sent' ? 'receiver' : 'sender']: receiver,
                timestamp: new Date().toISOString()
            });
            
            // Faqat oxirgi 50 ta sovg'ani saqlash
            if (history.length > 50) {
                history = history.slice(0, 50);
            }
            
            localStorage.setItem(historyKey, JSON.stringify(history));
        }
        
        function showGiftHistory() {
            const sentGifts = JSON.parse(localStorage.getItem('sentGifts')) || [];
            const receivedGifts = JSON.parse(localStorage.getItem('receivedGifts')) || [];
            
            const modal = document.getElementById('giftHistoryModal');
            const sentList = document.getElementById('sentGiftsList');
            const receivedList = document.getElementById('receivedGiftsList');
            
            if (!modal || !sentList || !receivedList) return;
            
            // Yuborilgan sovg'alar
            if (sentGifts.length > 0) {
                sentList.innerHTML = sentGifts.map(gift => `
                    <div class="gift-history-item">
                        <div class="gift-history-icon">${gift.gift.icon}</div>
                        <div class="gift-history-info">
                            <div class="gift-history-name">${gift.gift.name}</div>
                            <div class="gift-history-receiver">${gift.receiver.name} ga</div>
                            <div class="gift-history-time">${new Date(gift.timestamp).toLocaleString('uz-UZ')}</div>
                        </div>
                        <div class="gift-history-price">-${gift.gift.price}</div>
                    </div>
                `).join('');
            } else {
                sentList.innerHTML = `
                    <div class="empty-history">
                        <i class="fas fa-paper-plane"></i>
                        <p>Hali sovg'a yuborilmagan</p>
                    </div>
                `;
            }
            
            // Qabul qilingan sovg'alar
            if (receivedGifts.length > 0) {
                receivedList.innerHTML = receivedGifts.map(gift => `
                    <div class="gift-history-item received">
                        <div class="gift-history-icon">${gift.gift.icon}</div>
                        <div class="gift-history-info">
                            <div class="gift-history-name">${gift.gift.name}</div>
                            <div class="gift-history-sender">${gift.sender.name} dan</div>
                            <div class="gift-history-time">${new Date(gift.timestamp).toLocaleString('uz-UZ')}</div>
                        </div>
                    </div>
                `).join('');
            } else {
                receivedList.innerHTML = `
                    <div class="empty-history">
                        <i class="fas fa-gift"></i>
                        <p>Hali sovg'a qabul qilinmagan</p>
                    </div>
                `;
            }
            
            // Modalni ochish
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        // Global funksiyalarni qo'shish
        window.openGiftModal = openGiftModal;
        window.closeGiftModal = closeGiftModal;
        window.closeGiftHistoryModal = closeGiftHistoryModal;
        window.showGiftHistory = showGiftHistory;
        
        // Notification funksiyasi
        function showNotification(title, message) {
            const notification = document.getElementById('notification');
            const titleElement = document.getElementById('notificationTitle');
            const messageElement = document.getElementById('notificationMessage');
            
            if (notification && titleElement && messageElement) {
                titleElement.textContent = title;
                messageElement.textContent = message;
                notification.classList.add('active');
                
                setTimeout(() => {
                    notification.classList.remove('active');
                }, 3000);
            }
        }
    </script>
    
    <script src="main.js"></script>
</body>
</html>